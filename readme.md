# ADRB1 haplotype analysis

This repository contains code for detecting the haplotypes present in reads 
sequenced from amplicons of the ADRB1 ORF (NC_000010.11:114044133-114045566).
The target haplotype consists of a SNP at position 145 and another at 1165.

## Method

This method detects the haplotype of interest by interrogating the 145th
and 1165th bases of the aligned sequence.

## Alignment

Inputs to this analysis are BAM files generated by pbmm2. By default, pbmm2
excludes reads with an average score less than Q20 from processing. Hence, 
the number of "total aligning reads" on the TSV output will be less than the 
number of reads sequenced.

## Quality control

Input reads are at Q20 or above due to upstream analysis (alignment by pbmm2).
Additionally, to pass QC, each read must also:
- have optimal mapping quality (i.e. 60 for pbmm2)
- include both target loci (e.g. not too short, target loci not deleted)
- possess a valid haplotype (i.e. either AG, AC, GC, or GG)

## Invalid haplotypes

A count is printed to the TSV file of the number of reads for which
the bases of interest were available according to the alignment,
but the bases were not valid.

## Execution

To execute the analysis:
1. create a directory at the root of this repository named "bam".
2. create a subdirectory within `bam/` for each sample and place in it
a BAM file generated by mapping amplicon reads to adrb1.fa (found in root 
of repository).
3. Install `pysam` using `pip install pysam`, then execute the analysis using `python adrb1.py`